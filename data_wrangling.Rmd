---
title: "Data Wrangling for All Datasets Used"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(readr)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## MPV Dataset

```{r, warning=FALSE}
mpv_df =
  read_excel("./data/MPVDatasetDownload.xlsx",
             sheet = "2013-2020 Police Killings") %>%
  janitor::clean_names() %>% 
  separate(date_of_incident_month_day_year, c("year", "month", "day")) %>% 
  mutate(
    age = as.numeric(victims_age),
    gender  = victims_gender,
    race = victims_race,
    police_dept = agency_responsible_for_death,
    description = a_brief_description_of_the_circumstances_surrounding_the_death,
    disposition = official_disposition_of_death_justified_or_other,
    year = as.numeric(year),
    month = as.numeric(month),
    day = as.numeric(day)) %>%
  select(
    age, gender, race, police_dept, description, disposition, year,
    month, day, city, state, county, cause_of_death, criminal_charges,
    symptoms_of_mental_illness)

write_csv(mpv_df, "./data/mpv_tidy.csv")
```

In the above code chunk, the MPV dataset has been manipulated and tidied by reading in the excel sheet and cleaning the variable names, separating out the date variable, changing the names of some of the variables and changing some variables to be numeric, and selecting only the variables of importance to our analysis for inclusion in the tidied dataset.

## USA October 2020 Dataset

```{r usa, warning=FALSE}
usa_df =
  read_excel("./data/usa_2020_oct.xlsx") %>%
  janitor::clean_names() %>% 
  separate(event_date, c("year", "month", "day"))
```

## ACS Datasets


#### Age and Sex
```{r age, warning = FALSE}
age_df =
  read_csv("./data/acs_age_county.csv", skip = 1) %>% 
  janitor::clean_names() %>% 
  select(-c(4, 41:80, 117:156, 193:232, 269:308, 345:384, 421:458, starts_with("margin_of_error"))) %>% 
  separate(geographic_area_name, c("county", "state"), sep = ",") %>% view()
  pivot_longer(
     estimate_total_total_population_age_under_5_years:estimate_total_total_population_age_85_years_and_over,
     names_to = "age",
     values_to = "population_totals",
     names_prefix = "estimate_total_total_population_age"
    ) %>% view()
# error: says my variable isn't found 
  
  
   pivot_longer(
     cols = starts_with("estimate_percent_total"),
     names_to = "age_2",
     values_to = "population_percent", 
     names_prefix = "estimate_percent_total_population_age"
     ) %>% 
   pivot_longer(
     cols = starts_with("estimate_male_total"),
     names_to = "age_4",
     values_to = "male_totals", 
     names_prefix = "estimate_male_total_population_age"
     ) %>% 
   pivot_longer(
     cols = starts_with("estimate_percent_male_total"),
     names_to = "age_6",
     values_to = "male_percent", 
     names_prefix = "estimate_percent_male_total_population_age"
     ) %>% 
   pivot_longer(
     cols = starts_with("estimate_female_total"),
     names_to = "age_8",
     values_to = "female_totals", 
     names_prefix = "estimate_female_total_population_age"
     ) %>% 
   pivot_longer(
     cols = starts_with("estimate_percent_female_total"),
     names_to = "age_10",
     values_to = "female_percent", 
     names_prefix = "estimate_percent_female_total_population_age"
     ) %>% 
view()
```

## ACS Income

```{r}
income_df =
  read_csv("./data/acs_income_county.csv", skip = 1) %>% 
  janitor::clean_names() %>% 
  separate(geographic_area_name, c("county", "state"), sep = ",") %>% 
  select(
      -c(id, 
         starts_with("margin_of_error"), 
         starts_with("estimate_families"), 
         starts_with("estimate_married"), 
         starts_with("estimate_nonfamily"), 
         starts_with("estimate_households_percent"))
      ) %>%
  mutate(
    disparity_value = estimate_households_mean_income_dollars - estimate_households_median_income_dollars
  ) 

top_disparity = 
  income_df %>% 
  select(county, state, disparity_value) %>% 
  arrange(desc(disparity_value)) %>% 
  knitr::kable()

disparity_plot =
  income_df %>% 
    ggplot(aes(x = disparity_value)) + 
    geom_histogram()
```